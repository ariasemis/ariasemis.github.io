<section id="comments">
    <script src="/assets/js/comment.js" defer></script>

    <h2>Comments</h2>

    <form class="comment-form" method="POST" action="{{ site.comments_api }}" >
        
        <fieldset>
            <label class="autosize">
                <span>Leave a Comment:</span>
                <textarea
                    name="fields[message]"
                    rows="1"
                    oninput="this.parentNode.dataset.value = this.value"
                    spellcheck></textarea>
            </label>

            <label>
                <span>Name:</span>
                <input type="text" name="fields[name]">
            </label>

            <label>
                <span>E-mail:</span>
                <input type="email" name="fields[email]">
            </label>
        </fieldset>

        <fieldset class="hp">
            <label aria-hidden="true">
                <input type="text" name="fields[honey]" autocomplete="off" tabindex="-1" placeholder="Leave blank if you are a human">
            </label>
        </fieldset>

        <fieldset class="hidden">
            <input type="hidden" name="options[slug]" value="{{ page.slug }}">
            <input type="hidden" name="options[redirect]" value="{{ '/comment-submitted' | absolute_url }}">
        </fieldset>

        <p class="error-message" style="display: none;">
            <strong>Sorry, an error occurred!</strong> Please make sure to complete all required fields and try again.
        </p>
        <p class="success-message" style="display: none;">
            <strong>Thanks!</strong>  Your comment is under review. It will appear when approved.
        </p>

        <button>Submit</button>
    </form>

    {% if site.data.comments[page.slug] %}
    <div class="comment-list">
        {% assign comments = site.data.comments[page.slug] | sort %}
        {% for comment in comments %}
        {% assign index = forloop.index %}
        <div class="comment-item" id="comment-{{ index }}">
            <img class="comment-avatar" src="https://www.gravatar.com/avatar/{{ comment[1].email }}?d=mm&amp;s=80" alt="{{ comment[1].name }}">
            <div>
                <header class="comment-meta">
                    <strong>{{ comment[1].name }}</strong>
                    <time datetime="{{ comment[1].date | date_to_xmlschema }}">
                        <span class="ago"></span>
                        on {{ comment[1].date | date: "%Y-%m-%d" }}
                    </time>
                    <a href="#comment-{{ index }}" title="link to this comment" rel="bookmark">ðŸ”—</a>
                </header>
                <div>
                    {{ comment[1].message | markdownify }}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}

</section>